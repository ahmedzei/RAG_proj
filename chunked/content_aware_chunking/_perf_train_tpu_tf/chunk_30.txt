Check the TPU example notebook for code samples that explain this in more detail.